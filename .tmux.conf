#-------~---~----------~----------~----
#       .---..-.-.-..-..-..-..-.
#       `| |'| | | || || | >  <
#        `-' `-'-'-'`----''-''-'
#-------~---~----------~----------~----
set -g @tpm_plugins "              \
  tmux-plugins/tpm                 \
  tmux-plugins/tmux-open           \
  tmux-plugins/tmux-sessionist     \
  tmux-plugins/tmux-sidebar        \
  tmux-plugins/tmux-yank           \
"
# you can also add
# tmux-plugins/tmux-resurrect      \
run-shell ~/.tmux/plugins/tpm/tpm

# don't wait for an escape sequence after hitting
# Esc. fixes insert mode exit lag in vim
# set -sg escape-time 0
set -sg escape-time 1

# send the prefix to client inside window (ala nested sessions)
bind-key a send-prefix

setw -g aggressive-resize on

set -g prefix ^b
setw -g mode-mouse off
setw -g mode-keys vi

set -g history-limit 100000
# Use ZSH
set -g default-shell /bin/zsh
set -g default-command /bin/zsh

# for vim-alt(fixkey) keys compatibility
# try not to use it to prevent disconnect
set -g xterm-keys on

set -g default-terminal "screen-256color"

#--Paste'n'copy
bind p paste-buffer
bind-key -t vi-copy 'v' begin-selection
bind-key -t vi-copy 'y' copy-selection
bind-key -t vi-copy Escape cancel
bind-key -t vi-copy V select-line
bind-key -t vi-copy r rectangle-toggle

bind-key < command-prompt -p "send to tmux:" "run-shell 'tmux set-buffer -- \"$(xsel -o -b)\"'"
bind-key > command-prompt -p "send to xsel:" "run-shell 'tmux show-buffer | xsel -i -b'"

bind -n M-n new-window
unbind [
bind Escape copy-mode
# toggle last window like screen
bind-key C-b last-window
bind-key k kill-window
# confirm before killing the server
bind-key K confirm kill-server
# toggle statusbar
bind-key b set-option status
# ctrl+left/right cycles thru windows
bind-key -n C-right next
bind-key -n C-left prev
# open a man page in new window
bind m command-prompt "split-window 'exec man %%'"
# listen for activity on all windows
set -g bell-action any
# on-screen time for display-panes in ms
set -g display-panes-time 2000
# start window indexing at one instead of zero
set -g base-index 1
# enable wm window titles
setw -g automatic-rename yes
# border colours
set -g pane-border-fg blue
set -g pane-active-border-bg default
# wm window title string (uses statusbar variables)
set -g set-titles on
set-option -g set-titles-string 'tmux:#I [ #W #T ]'
# statusbar --------------------------------------------------------------
set -g status-interval 1
set -g status-justify centre # center align window list
set -g status-left-length 10

# default statusbar colors
set -g status-fg white
set -g status-bg default

set -g status-attr bright

set-option -g status-interval 5
set-option -g status-left-length 60
set-option -g visual-activity on
set -g status-keys vi

# default window title colors
set-window-option -g window-status-fg white
set-window-option -g window-status-bg default
set-window-option -g window-status-attr dim
# active window title colors
set-window-option -g window-status-current-fg white
set-window-option -g window-status-current-bg default
set-window-option -g window-status-current-attr bright
# command/message line colors
set -g message-fg white
set -g message-bg black
set -g message-attr bright
#set -g default-terminal "screen"
setw -g aggressive-resize on
set-window-option -g aggressive-resize on

bind space command-prompt -p index "select-window"
bind S command-prompt -p "Host?" "new-window -n 'ssh:%1' 'ssh %1'"
bind A command-prompt -p "Name?" "setw automatic-rename off; rename-window %%"
bind p command-prompt -p "Filename?" "capture-pane; save-buffer %%; delete-buffer"
bind e command-prompt -p "Eval?" "display-message -p 'exec ruby -e %%'"

# UTF8
setw -g utf8 on
set -g status-utf8 on

# Choose Window
bind M choose-window
# Choose Session
bind a choose-session

# pane/window movement
unbind b
unbind B
bind-key j command-prompt -p "join pane from:" "join-pane -s '%%'"
bind-key s command-prompt -p "send pane to:" "join-pane -t '%%'"
bind-key S command-prompt -p "swap window with:" "swap-window -t ':%%'"
bind-key m command-prompt -p "move window to:" "move-window -t ':%%'"

# environment
set -g update-environment "DISPLAY SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY"

# Basic moving/resizing/swapping (sort of vi-like)
bind C-h select-pane -L
bind C-j select-pane -D
bind C-k select-pane -U
bind C-l select-pane -R

bind | split-window -h
bind _ split-window -v
bind R source-file ~/.tmux.conf \; display-message "  Config reloaded..".

# Copy into clipboard
bind C-c choose-buffer "run \"tmux save-buffer -b '%%' - | xsel -i -b\""
# Paste from clipboard
bind C-v run "xsel -o -b | tmux load-buffer - && tmux paste-buffer"
# Copy into primary
bind C-y choose-buffer "run \"tmux save-buffer -b '%%' - | xsel -i\""
# Paste from primary
bind C-p run "xsel -o | tmux load-buffer - && tmux paste-buffer"

#--------[My last status conf]---------------------------
set-option -g status-left   '#[fg=magenta]» '
set-option -g status-right  '#[fg=cyan]»» #[fg=blue,bold]##S'

## Unbinds
setw -g window-status-format ' #[fg=default,nobright]#I: #W '
setw -g window-status-current-format '#[fg=blue,nobright][#[fg=default,nobright]#I: #W#[fg=blue]]'

bind -n M-Tab next-window
bind -n M-BTab previous-window

bind -r h resize-pane -L 1
bind -r j resize-pane -D 1
bind -r k resize-pane -U 1
bind -r l resize-pane -R 1

bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

bind -n M-C-w if-shell 'test `~/bin/scripts/not_tmuxed_wim` == "TRUE"' kill-pane

bind X next-layout
bind Z previous-layout

# for ~/.tmux.conf
# urlscan as context and url view
bind-key U capture-pane \; save-buffer /tmp/tmux-buffer \; \
        new-window -n "urlscan" '$SHELL -c "urlscan -c < /tmp/tmux-buffer"'

#set -g pane-border-bg default
#set -g pane-border-fg colour235
#set -g pane-active-border-bg default
#set -g pane-active-border-fg colour240
#set -g display-panes-colour colour233
#set -g display-panes-active-colour colour245
set -g mode-bg colour243
set -g mode-fg colour232

bind -n C-M-h run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-M-h) || tmux select-pane -L"
bind -n C-M-j run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-M-j) || tmux select-pane -D"
bind -n C-M-k run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-M-k) || tmux select-pane -U"
bind -n C-M-l run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-M-l) || tmux select-pane -R"
