#!/bin/bash
# script to prepare icon for dunst:
# 1. convert to png (dunst only works with png currently)
# 2. resize if icon too large

# appname="$1"
summary="$2"
body="$3"
image="$4"
urgency="$5"

# if [[ -f "$image" ]] && \
# else
# 	# no changes necessary
# 	new_image="$4"
# fi

# if [[ ! $(file --mime-type "$image" | grep -q "image/png") || $(identify -format "%w" "$image") -gt 200 ]]; then
    file_name=$(basename "$image")
    file_name=${file_name%.*}
    mkdir -p /tmp/dunst-images
    new_image=/tmp/dunst-images/"${file_name}.png"
    # convert -resize 200x -format png "$image" "$new_image"
    convert -resize 200x "$image" "$new_image"
# fi

# send notification with compatible image
notify-send -a "prepare_image" -u "$urgency" -i "$new_image" "$summary" "$body"
# rm /tmp/dunst-images/*
