#!/bin/zsh

wf_(){
    builtin print "${st_}[${cl_}${bold_}$1${cl_}${st_}]${cl_} "
}

highlight_(){
    local msg="$(xrq color$1)"
    builtin print "<span weight='bold' color='${msg}'>"
}

send_notify_(){ 
    notify-send  "$(wf_ "Move")$(wf_ "${file}") -> $(wf_ ${HOME}/tmp)"
}

main(){
    st_=$(highlight_ 4)
    bold_="<span weight='bold'>"
    prefix_=$(wf_ "âž£")

    # Transmission-related stuff
    inotifywait -m -q -e close_write --format "%f" ${XDG_DOWNLOAD_DIR}/ \
        | while IFS= read -r file; do
        if [[ "${file}" =~ ".torrent.added"$ ]]; then
            send_notify_ "Move ["${file}"] -> ${HOME}/tmp"
            mv "${file}" "${HOME}/tmp"
        fi
    done
}

main "$@"
