#!/bin/zsh

MPV_SOCKET="/tmp/mpv.socket"

main(){
    if [[ $# == 0 ]]; then
        vol_manager
    else
        local inc_=1
        local status_

        local addr_=127.0.0.1 
        local port_=6600

        status_=$(grep 'state: ' <<< \
            $( \
                echo -ne "status\nclose\n" | \
                netcat "${addr_}" "${port_}" \
            ) \
            | awk '{print $2}'
        )
        if [[ ${status_} == "play" ]]; then
            echo -ne "volume "$1"\nclose\n" | \
            netcat "${addr_}" "${port_}"
        else
            mpvc -v "$1"
        fi
    fi
}

# Inspired by z3bra and dkeg
state() {
    amixer get Master | sed -n 's/^.*\[\(o[nf]\+\)]$/\1/p' | uniq
}

vol_manager(){
    local pulse_=true
    local term_class="st"
    if [[ $(xprop -id $(pfw) | grep -ow "${term_class}" | head -1) = "${term_class}"  ]]; then
        pulsemixer
    else
        if [[ ! -e ${pulse_} ]]; then
            st pulsemixer && exit
        else
            st alsamixer -g && exit 
        fi
    fi
}

main "$@"
