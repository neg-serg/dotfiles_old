#!/bin/bash
touch /tmp/pass_clipped_fifo
mail_key_="$(gpg -dq ~/.mail_.gpg)"

(   
    inotifywait -e close_write /tmp/pass_clipped_fifo >/dev/null 2>&1
    user_pass=$(gpg -d -r "${mail_key_}" --no-tty <  /tmp/pass_clipped_fifo 2>/dev/null)
    pass=$(echo "${user_pass}" | head -n1)
    user=$(echo "${user_pass}" | grep "user" | awk -F ":" '{print $2}' | awk '{print $1}')
    xdotool keyup Super_L Shift_L Control_L
    xdotool type "${user}"
    xdotool key Tab
    sleep .1
    xdotool type "${pass}"
    notify-no-icon "${unlocked_} pasted [$(< /tmp/pass_picked)]"
) &
~/bin/p/get_pass
