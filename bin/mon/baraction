#!/bin/bash
# Status script for scrotwm

bat(){
	ac="$(awk 'NR==1 {print +$4}' <(acpi -V))"
	onl="$(grep "on-line" <(acpi -V))"
	if [ -z "$onl" ] && [ "$ac" -gt "15" ]; then
         echo -e "BAT #47959E#$ac%##"
	elif [ -z "$onl" ] && [ "$ac" -le "15" ]; then
		 echo -e "#CF4F88#BAT $ac%##"
	else
		 echo -e "AC #47959E#$ac%##"
	fi
}

mem(){
	mem="$(awk '/^-/ {print $3}' <(free -m))"
    echo -e "#53A6A6#$mem##" 
}

   # CPU line courtesy Procyon:https://bbs.archlinux.org/viewtopic.php?pid=874333#p874333
cpu(){
	read cpu a b c previdle rest < /proc/stat
	prevtotal=$((a+b+c+previdle))
	sleep 0.5
	read cpu a b c idle rest < /proc/stat
	total=$((a+b+c+idle))
	cpu="$((100*( (total-prevtotal) - (idle-previdle) ) / (total-prevtotal) ))"
    echo -e "#BF85CC#$cpu%##" 
	}

hdd(){
	hd="$(df -P | sort -d | awk '/^\/dev\//{s=s (s?" ":"") $5} END {printf "%s", s}')"
    echo -e "#7E62B3#$hd##" 
}

eml(){
	maildirs="$HOME/Mail/*/INBOX/new/"
	ml="$(find $maildirs -type f | wc -l)"
	if [ $ml == 0 ]; then
		 echo -e "0"
	else
		 echo -e "#CF4F88#$ml##"
	fi
}

pac(){
	pup="$(pacman -Qu | wc -l)"
	if [ $pup == 0 ]; then
	    echo -e "0"
	else
	    echo -e "#914E89#$pup##"
	fi
}

int(){
	host google.com>/dev/null &&
    echo -e "#4779B3#ON##" || echo -e "#CF4F88#NO##"
}

tme() {
    tme="$(date "+%I:%M")"
    echo -e "#E0E0E0#$tme##"
}

bar() { echo -e "#4F4F4F#|##" ;}

sleep_sec=5
while :; do
    echo -e "$(bat) $(bar) CPU $(cpu) MEM $(mem) $(bar) HDD $(hdd) $(bar) EML $(eml) PKG $(pac) $(bar) NET $(int) $(bar) $(tme) "
    sleep $sleep_sec
done
